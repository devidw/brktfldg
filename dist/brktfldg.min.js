!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.brktfldg=e():t.brktfldg=e()}(self,(()=>(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{collapseBrackets:()=>n});class o{options={openChar:"(",closeChar:")",placeholder:"⋅⋅⋅",shortMaxWords:1,wordCount:!0,expandShortOnHover:!0};constructor(t,e={}){this.el=t,this.options={...this.options,...e}}getBrackets(t){const e=[];if(!t.hasChildNodes())return e;for(const o of t.childNodes)if(o.nodeType===Node.TEXT_NODE){let t=o.nodeValue;const n=t.match(/\(|\)/g);if(!n)continue;const r=t.length;for(const s of n){const n=r-t.length,l=t.indexOf(s),i=n+l;t=t.slice(l+1),e.push({char:s,node:o,offset:i})}}else o.nodeType===Node.ELEMENT_NODE&&o.hasChildNodes()&&"SCRIPT"!==o.tagName&&e.push(...this.getBrackets(o));return e}getPairs(t){return function(t){const e=[];for(let o=0;o<t.length;o+=2)e.push([t[o],t[o+1]]);return e}(t)}wrapBrackets(t){if(t.length){t.reverse();for(const e of t){const[t,o]=e,n=document.createRange();n.setStart(t.node,t.offset),n.setEnd(o.node,o.offset+1);const r=document.createElement("brktfldg-container");r.setAttribute("data-brktfldg-open-char",this.options.openChar),r.setAttribute("data-brktfldg-close-char",this.options.closeChar);const s=document.createElement("brktfldg-toggle");s.setAttribute("data-brktfldg-placeholder",this.options.placeholder);const l=document.createElement("brktfldg-content");n.surroundContents(l),l.parentElement.insertBefore(r,l),r.appendChild(s),r.appendChild(l),l.firstChild.nodeValue=l.firstChild.nodeValue.slice(1),l.lastChild.nodeValue=l.lastChild.nodeValue.slice(0,-1)}}}processWordCounts(){this.el.querySelectorAll("brktfldg-container").forEach((t=>{const e=t.querySelector("brktfldg-content"),o=t.querySelector("brktfldg-toggle"),n=function(t){let e=document.createElement("DIV");return e.innerHTML=t,e.textContent||e.innerText||""}(e.innerHTML).trim().replace(/\s+/g," ").split(" ").length;this.options.wordCount&&o.setAttribute("data-brktfldg-word-count",n),n<=this.options.shortMaxWords&&t.classList.add("brktfldg-container--short")}))}setEventListeners(){this.el.querySelectorAll("brktfldg-toggle").forEach((t=>{const e=t.parentElement;t.addEventListener("click",(()=>{e.classList.toggle("brktfldg-container--open")})),this.options.expandShortOnHover&&e.classList.contains("brktfldg-container--short")&&t.addEventListener("mouseover",(()=>{e.classList.contains("brktfldg-container--open")||e.classList.add("brktfldg-container--open")}))}))}collapseBrackets(){const t=this.getBrackets(this.el),e=this.getPairs(t);this.wrapBrackets(e),(this.options.wordCount||this.options.expandShortOnHover)&&this.processWordCounts(),this.setEventListeners()}}function n(t,e){new o(t,e).collapseBrackets()}return e})()));